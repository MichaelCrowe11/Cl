(()=>{var e={};e.id=90,e.ids=[90],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4038:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>p});var n={};a.r(n),a.d(n,{GET:()=>l,POST:()=>u});var s=a(6559),r=a(8088),i=a(7719),c=a(2190),o=a(8964);async function l(e){try{let{searchParams:t}=new URL(e.url);switch(t.get("action")||"status"){case"status":let a=o.h.getCurrentStatus();return c.NextResponse.json({...a,timestamp:new Date().toISOString(),system:"Crowe Logic GPT - Mycology Research Suite",version:"1.0.0-alpha"});case"gate-check":let n=o.h.shouldGateDeployment();return c.NextResponse.json({deployment:{allowed:!n.gate,reason:n.reason,timestamp:new Date().toISOString()}});case"metrics-only":let{metrics:s}=o.h.getCurrentStatus();return c.NextResponse.json({metrics:s,timestamp:new Date().toISOString()});default:return c.NextResponse.json({error:"Invalid action. Use: status, gate-check, or metrics-only"},{status:400})}}catch(e){return c.NextResponse.json({error:"Failed to retrieve QFOL metrics"},{status:500})}}async function u(e){try{let t=await e.json(),{type:a,sessionId:n,data:s}=t;if(!a||!n)return c.NextResponse.json({error:"Missing required fields: type, sessionId"},{status:400});let r=o.h.logEvent({type:a,sessionId:n,data:s||{},userId:t.userId});return c.NextResponse.json({success:!0,eventId:r.id,metrics:r.metrics,timestamp:r.timestamp})}catch(e){return c.NextResponse.json({error:"Failed to log QFOL event"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/qfol/route",pathname:"/api/qfol",filename:"route",bundlePath:"app/api/qfol/route"},resolvedPagePath:"/workspaces/Cl/app/api/qfol/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:h,workUnitAsyncStorage:p,serverHooks:g}=d;function m(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:p})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},8964:(e,t,a)=>{"use strict";a.d(t,{h:()=>s});class n{logEvent(e){let t={...e,id:`qfol_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date};return this.events.push(t),this.calculateMetrics(t),t}calculateMetrics(e){let t=this.getRecentEvents(24),a=this.calculateDEI(t),n=this.calculateHIG(e,t),s=this.calculateEEG(e,t);e.metrics={dei:a,hig:n,eeg:s}}calculateDEI(e){let t=e.filter(e=>"query"===e.type);if(0===t.length)return{entropyScore:0,noveltyRate:0,divergenceIndex:0,lastUpdated:new Date};let a=this.extractTopics(t),n=this.countTopics(a),s=this.calculateEntropy(n);return{entropyScore:Math.min(s,1),noveltyRate:new Set(a).size/a.length,divergenceIndex:this.calculateDivergence(t),lastUpdated:new Date}}calculateHIG(e,t){let a=this.getQueryResponsePairs(t),n=this.analyzeIntentAlignment(a),s=this.calculateContextualRelevance(e);return{intentAlignment:n,contextualRelevance:s,actionableInsights:this.calculateActionableRate(t),userSatisfaction:this.calculateUserSatisfaction(t),lastUpdated:new Date}}calculateEEG(e,t){let a=this.detectBias(e),n=this.assessSafety(e);return{biasScore:1-a,safetyScore:n,transparencyIndex:this.assessTransparency(e),ethicalCompliance:this.checkEthicalCompliance(e),lastUpdated:new Date}}getCurrentStatus(){let e=this.getRecentEvents(24);if(0===e.length)return{status:"optimal",metrics:this.getDefaultMetrics(),recommendations:["Start using the system to generate QFOL metrics"]};let t=this.aggregateMetrics(e),a=this.determineStatus(t),n=this.generateRecommendations(t);return{status:a,metrics:t,recommendations:n}}shouldGateDeployment(){let{metrics:e}=this.getCurrentStatus();return e.eeg.ethicalCompliance<this.ETHICAL_THRESHOLD?{gate:!0,reason:`Ethical compliance score ${e.eeg.ethicalCompliance} below threshold ${this.ETHICAL_THRESHOLD}`}:e.eeg.safetyScore<this.ETHICAL_THRESHOLD?{gate:!0,reason:`Safety score ${e.eeg.safetyScore} below threshold ${this.ETHICAL_THRESHOLD}`}:{gate:!1}}getRecentEvents(e){let t=new Date(Date.now()-36e5*e);return this.events.filter(e=>e.timestamp>t)}extractTopics(e){return e.map(e=>{let t=e.data.input||e.data.output||"",a=[];return(t.includes("cultivation")||t.includes("growing"))&&a.push("cultivation"),(t.includes("identification")||t.includes("species"))&&a.push("identification"),(t.includes("substrate")||t.includes("medium"))&&a.push("substrates"),(t.includes("contamination")||t.includes("sterile"))&&a.push("contamination"),(t.includes("harvest")||t.includes("yield"))&&a.push("harvesting"),a.length>0?a[0]:"general"})}countTopics(e){return e.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{})}calculateEntropy(e){let t=Object.values(e).reduce((e,t)=>e+t,0);return 0===t?0:-Object.values(e).map(e=>e/t).reduce((e,t)=>e+(t>0?t*Math.log2(t):0),0)/Math.log2(Object.keys(e).length||1)}calculateDivergence(e){return .8*Math.random()+.1}getQueryResponsePairs(e){return[]}analyzeIntentAlignment(e){return .4*Math.random()+.6}calculateContextualRelevance(e){let t=e.data.input||e.data.output||"",a=["mushroom","fungi","mycelium","spore","cultivation","substrate","fruiting"];return Math.min(2*(a.filter(e=>t.toLowerCase().includes(e)).length/a.length),1)}calculateActionableRate(e){return .5*Math.random()+.4}calculateUserSatisfaction(e){let t=e.filter(e=>e.data.userFeedback);return 0===t.length?.5:t.reduce((e,t)=>{let a=t.data.userFeedback;return e+.25*!!a.helpful+.25*!!a.accurate+.25*!!a.actionable+.25*!a.biased},0)/t.length}detectBias(e){let t=e.data.output||"",a=["always","never","all","none","definitely","impossible"];return Math.min(a.filter(e=>t.toLowerCase().includes(e)).length/a.length,1)}assessSafety(e){let t=e.data.output||"",a=["poisonous","toxic","dangerous","harmful"].some(e=>t.toLowerCase().includes(e)),n=t.toLowerCase().includes("disclaimer")||t.toLowerCase().includes("consult");return a&&n?.9:a&&!n?.3:.7}assessTransparency(e){let t=e.data.output||"",a=["because","due to","research shows","studies indicate","evidence suggests"];return Math.min(2*(a.filter(e=>t.toLowerCase().includes(e)).length/a.length),1)}checkEthicalCompliance(e){return .3*Math.random()+.7}aggregateMetrics(e){let t=e.filter(e=>e.metrics);if(0===t.length)return this.getDefaultMetrics();let a=t.reduce((e,t)=>{let a=t.metrics;return e.dei.entropyScore+=a.dei.entropyScore,e.dei.noveltyRate+=a.dei.noveltyRate,e.dei.divergenceIndex+=a.dei.divergenceIndex,e.hig.intentAlignment+=a.hig.intentAlignment,e.hig.contextualRelevance+=a.hig.contextualRelevance,e.hig.actionableInsights+=a.hig.actionableInsights,e.hig.userSatisfaction+=a.hig.userSatisfaction,e.eeg.biasScore+=a.eeg.biasScore,e.eeg.safetyScore+=a.eeg.safetyScore,e.eeg.transparencyIndex+=a.eeg.transparencyIndex,e.eeg.ethicalCompliance+=a.eeg.ethicalCompliance,e},this.getDefaultMetrics()),n=t.length;return{dei:{entropyScore:a.dei.entropyScore/n,noveltyRate:a.dei.noveltyRate/n,divergenceIndex:a.dei.divergenceIndex/n,lastUpdated:new Date},hig:{intentAlignment:a.hig.intentAlignment/n,contextualRelevance:a.hig.contextualRelevance/n,actionableInsights:a.hig.actionableInsights/n,userSatisfaction:a.hig.userSatisfaction/n,lastUpdated:new Date},eeg:{biasScore:a.eeg.biasScore/n,safetyScore:a.eeg.safetyScore/n,transparencyIndex:a.eeg.transparencyIndex/n,ethicalCompliance:a.eeg.ethicalCompliance/n,lastUpdated:new Date}}}determineStatus(e){return e.eeg.ethicalCompliance<this.ETHICAL_THRESHOLD||e.eeg.safetyScore<this.ETHICAL_THRESHOLD?"critical":e.dei.entropyScore<this.ENTROPY_THRESHOLD||e.hig.intentAlignment<this.ALIGNMENT_THRESHOLD?"warning":"optimal"}generateRecommendations(e){let t=[];return e.dei.entropyScore<this.ENTROPY_THRESHOLD&&t.push("Encourage more diverse query exploration"),e.hig.intentAlignment<this.ALIGNMENT_THRESHOLD&&t.push("Improve response relevance to user intents"),e.eeg.ethicalCompliance<this.ETHICAL_THRESHOLD&&t.push("Review and improve ethical compliance measures"),0===t.length&&t.push("QFOL metrics are optimal - continue current practices"),t}getDefaultMetrics(){return{dei:{entropyScore:.5,noveltyRate:.5,divergenceIndex:.5,lastUpdated:new Date},hig:{intentAlignment:.5,contextualRelevance:.5,actionableInsights:.5,userSatisfaction:.5,lastUpdated:new Date},eeg:{biasScore:.5,safetyScore:.5,transparencyIndex:.5,ethicalCompliance:.5,lastUpdated:new Date}}}constructor(){this.events=[],this.ENTROPY_THRESHOLD=.6,this.ALIGNMENT_THRESHOLD=.7,this.ETHICAL_THRESHOLD=.8}}let s=new n},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[447,580],()=>a(4038));module.exports=n})();